@model ProductDetailsViewModel

@{
    ViewData["Title"] = Model.Product.Name;
}

<div class="product-details">

    <!-- Product Image -->
    <div class="product-image">
        <img src="@Model.Product.ImageUrl" alt="@Model.Product.Name" />
    </div>

    <!-- Product Info -->
    <div class="product-info">
        <small class="brand">Flappy Clouds</small>
        <h2>@Model.Product.Name</h2>
        <div class="price">$@Model.Product.Price</div>

        @if (Model.Product.StockQuantity > 0)
        {
                <div class="status">Available</div>
        }
        else
        {
                <div class="status" style="background-color: #f2dede; color: #a94442;">Out of Stock</div>
        }

        <p>@Model.Product.Description</p>

        <p>
            <strong> NOTE: Each item is made with the highest attention to quality and care. Due to the nature of handmade items, gentle use is recommended.</strong>
        </p>

        <div class="quantity">
            Quantity:
            <input type="number" value="1" min="1" max="@Model.Product.StockQuantity"
            @(Model.Product.StockQuantity > 0 ? "" : "disabled") />
        </div>

        <div class="buttons">
            <button type="button" class="add-to-cart" onclick="addToCart(@Model.Product.ProductId, event)"
            @(Model.Product.StockQuantity > 0 ? "" : "disabled")>
                Add to Cart
            </button>
            <button class="buy-now" @(Model.Product.StockQuantity > 0 ? "" : "disabled")>Buy Now</button>
        </div>

    </div>

</div>

<div class="product-section">
    <h3 class="suggestion-section-title">Similar Products</h3>
    <hr/>

    <div class="suggestion-grid">
        @foreach (var product in Model.RelatedProducts)
        {
            <div class="card">
                <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">@product.Name</h5>
                    <p class="card-text fw-bold">$@product.Price</p>
                    <a href="@Url.Action("Details", "Product", new { id = product.ProductId })" class="product-btn">View Details</a>
                </div>
            </div>
        }
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function addToCart(productId, event) {
        var quantityInput = event.target.closest('.product-info').querySelector('input');
        var quantity = quantityInput.value;

        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
            },
            body: JSON.stringify({ productId: productId, quantity: parseInt(quantity) })
        })
        .then(response => response.json())
        .then(data => {
            Swal.fire({
                title: 'Added to Cart!',
                text: data.message,
                icon: 'success',
                confirmButtonText: 'OK'
            });
        })
        .catch(error => {
            Swal.fire({
                title: 'Error',
                text: 'Something went wrong!',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        });
    }
</script>

</script>

