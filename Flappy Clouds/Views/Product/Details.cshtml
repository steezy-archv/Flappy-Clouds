@model ProductDetailsViewModel

@{
    ViewData["Title"] = Model.Product.Name;
}

<div class="product-details">

    <!-- Product Image -->
    <div class="product-image">
        <img src="@Model.Product.ImageUrl" alt="@Model.Product.Name" />
    </div>

    <!-- Product Info -->
    <div class="product-info">
        <small class="brand">Flappy Clouds</small>
        <h2>@Model.Product.Name</h2>
        <div class="price">$@Model.Product.Price</div>

        @if (Model.Product.StockQuantity > 0)
        {
                <div class="status">Available</div>
        }
        else
        {
                <div class="status" style="background-color: #f2dede; color: #a94442;">Out of Stock</div>
        }

        <p>@Model.Product.Description</p>

        <p>
            <strong> NOTE: Each item is made with the highest attention to quality and care. Due to the nature of handmade items, gentle use is recommended.</strong>
        </p>

        <div class="quantity">
            Quantity:
            <input type="number" value="1" min="1" max="@Model.Product.StockQuantity" />
        </div>

        <div class="buttons">
            <button type="button" class="add-to-cart" onclick="addToCart(@Model.Product.ProductId)">Add to Cart</button>
            <button class="buy-now">Buy Now</button>
        </div>
    </div>

</div>

<div class="product-section">
    <h3 class="text-lg-start">Similar Products</h3>
    <hr/>

    <div class="product-grid">
        @foreach (var product in Model.RelatedProducts)
        {
            <div class="card">
                <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">@product.Name</h5>
                    <p class="card-text fw-bold">$@product.Price</p>
                    <a href="@Url.Action("Details", "Product", new { id = product.ProductId })" class="product-btn">View Details</a>
                </div>
            </div>
        }
    </div>
</div>

<script>
    function addToCart(productId) {
        var quantity = document.querySelector('.quantity input').value; // Fix this to select the correct input element

        console.log("Product ID:", productId, "Quantity:", quantity);

        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
            },
            body: JSON.stringify({ productId: productId, quantity: parseInt(quantity) })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);  // Show the response message to the user
        })
        .catch(error => {
            alert('Error: ' + error.message);  // Handle any errors during the fetch
        });
    }
</script>

