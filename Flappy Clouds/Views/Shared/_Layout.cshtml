@using Microsoft.EntityFrameworkCore
@inject Flappy_Clouds.Entities.FlappyCloudsContext _context

@* @{
    var email = User.Identity.Name;
    var user = await _context.Users.FirstOrDefaultAsync(u => u.Email == email);
    var isAdmin = user?.Role == "Admin";
} *@

@{
    var isAdmin = false;
    if (Context.User.Identity.IsAuthenticated)
    {
        var role = Context.Items["UserRole"] as string;
        isAdmin = role == "Admin";
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Flappy Clouds</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @* <link rel="stylesheet" href="~/Flappy_Clouds.styles.css" asp-append-version="true" /> *@
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <!-- Top row: Search bar, User icon, Cart icon -->
        <input type="text" placeholder="Search products" class="search-bar">

        <div class="header-icons">
            <button class="icon user-icon" id="userIcon">
                <svg width="33" height="34" viewBox="0 0 33 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.50625 25.2875C7.8875 24.2313 9.43125 23.3984 11.1375 22.7891C12.8438 22.1797 14.6313 21.875 16.5 21.875C18.3687 21.875 20.1563 22.1797 21.8625 22.7891C23.5688 23.3984 25.1125 24.2313 26.4937 25.2875C27.4417 24.1771 28.1797 22.9177 28.7078 21.5094C29.2359 20.101 29.5 18.5979 29.5 17C29.5 13.3979 28.2339 10.3307 25.7016 7.79844C23.1693 5.26615 20.1021 4 16.5 4C12.8979 4 9.83073 5.26615 7.29844 7.79844C4.76615 10.3307 3.5 13.3979 3.5 17C3.5 18.5979 3.76406 20.101 4.29219 21.5094C4.82031 22.9177 5.55833 24.1771 6.50625 25.2875ZM16.5 18.625C14.9021 18.625 13.5547 18.0766 12.4578 16.9797C11.3609 15.8828 10.8125 14.5354 10.8125 12.9375C10.8125 11.3396 11.3609 9.99219 12.4578 8.89531C13.5547 7.79844 14.9021 7.25 16.5 7.25C18.0979 7.25 19.4453 7.79844 20.5422 8.89531C21.6391 9.99219 22.1875 11.3396 22.1875 12.9375C22.1875 14.5354 21.6391 15.8828 20.5422 16.9797C19.4453 18.0766 18.0979 18.625 16.5 18.625ZM16.5 33.25C14.2521 33.25 12.1396 32.8234 10.1625 31.9703C8.18542 31.1172 6.46562 29.9594 5.00312 28.4969C3.54062 27.0344 2.38281 25.3146 1.52969 23.3375C0.676562 21.3604 0.25 19.2479 0.25 17C0.25 14.7521 0.676562 12.6396 1.52969 10.6625C2.38281 8.68542 3.54062 6.96562 5.00312 5.50312C6.46562 4.04062 8.18542 2.88281 10.1625 2.02969C12.1396 1.17656 14.2521 0.75 16.5 0.75C18.7479 0.75 20.8604 1.17656 22.8375 2.02969C24.8146 2.88281 26.5344 4.04062 27.9969 5.50312C29.4594 6.96562 30.6172 8.68542 31.4703 10.6625C32.3234 12.6396 32.75 14.7521 32.75 17C32.75 19.2479 32.3234 21.3604 31.4703 23.3375C30.6172 25.3146 29.4594 27.0344 27.9969 28.4969C26.5344 29.9594 24.8146 31.1172 22.8375 31.9703C20.8604 32.8234 18.7479 33.25 16.5 33.25Z" fill="#5B462E" />
                </svg>
            </button>

            <div class="dropdown" id="userDropdown">
                @if (User.Identity.IsAuthenticated)
                {
                    @if (isAdmin)
                    {
                        <a class="dropdown-item" href="/Admin/Dashboard">Admin Dashboard</a>
                    }
                    <a class="dropdown-item" asp-controller="Account" asp-action="Logout">Logout</a>
                }
                else
                {
                    <a class="dropdown-item" asp-controller="Account" asp-action="Login">Login</a>
                    <a class="dropdown-item" asp-controller="Account" asp-action="Registration">Register</a>
                }
            </div>

            <a class="icon cart-icon" asp-controller="Cart" asp-action="Index">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_9_304)">
                        <path d="M1.66669 1.66663H8.33335L12.8 23.9833C12.9524 24.7506 13.3699 25.4399 13.9793 25.9305C14.5887 26.421 15.3512 26.6816 16.1334 26.6666H32.3333C33.1155 26.6816 33.878 26.421 34.4874 25.9305C35.0968 25.4399 35.5143 24.7506 35.6667 23.9833L38.3334 9.99996H10M16.6667 35C16.6667 35.9204 15.9205 36.6666 15 36.6666C14.0795 36.6666 13.3334 35.9204 13.3334 35C13.3334 34.0795 14.0795 33.3333 15 33.3333C15.9205 33.3333 16.6667 34.0795 16.6667 35ZM35 35C35 35.9204 34.2538 36.6666 33.3334 36.6666C32.4129 36.6666 31.6667 35.9204 31.6667 35C31.6667 34.0795 32.4129 33.3333 33.3334 33.3333C34.2538 33.3333 35 34.0795 35 35Z" stroke="#5B462E" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                        <clipPath id="clip0_9_304">
                            <rect width="40" height="40" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </a>
        </div>
        @* <div>
            @await Html.PartialAsync("_LoginPartial")
        </div> *@
    </header>

    <!-- Title section -->
    <section class="title-section">
        <h2>Welcome to</h2>
        <h1>Flappy Clouds</h1>
        
    </section>

    <!-- Navigation bar -->
    <nav class="nav-bar">
        <a asp-controller="Home" asp-action="Index" class="nav-link">Home</a>
        <a asp-controller="Product" asp-action="Products" class="nav-link">Shop</a>
        <a href="#" class="nav-link">Contact</a>
        <a href="#" class="nav-link">Shipping Policy</a>
    </nav>

    <div class="container">
        <main role="main">
            @RenderBody()
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="subscribe">
            <h3>Subscribe to our emails</h3>
            <p>Stay updated with the latest news, promos, and product launches.</p>
            <input type="email" placeholder="Email">
            <button>Subscribe</button>
        </div>
        <div class="footer-links">
            <div class="quick-links">
                <h4>Quick Links</h4>
                <a href="#">Home</a>
                <a href="#">Shipping Policy</a>
            </div>
            <div class="social-links">
                <h4>Find us on</h4>
                <a href="#">Instagram</a>
                <a href="#">Facebook</a>
            </div>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
